{"ts":1361399625809,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"!!!5\r\nhtml\r\n    title Inventory Update\r\n    include includes/common_head\r\n\r\n    script\r\n        $(document).ready(function() {\r\n          //$('#od_sphere').mask('99999.99');\r\n          applyUIStyle();\r\n\r\n          $('#type').change(function() {\r\n                if($(this).val() == \"S\")\r\n                {\r\n                    $(\"#od_add\").attr(\"disabled\",\"disabled\").val(\"\");\r\n                    $(\"#os_add\").attr(\"disabled\",\"disabled\").val(\"\");\r\n                }\r\n                else\r\n                {\r\n                    $(\"#od_add\").removeAttr(\"disabled\");\r\n                    $(\"#os_add\").removeAttr(\"disabled\");\r\n                }\r\n            });\r\n\r\n         $(\"#od_axis,#os_axis\").blur(function(){\r\n                formatDegrees($(this));\r\n                if($(\"#os_axis\").val()==\"\")\r\n                    $(\"#os_axis\").val($(\"#od_axis\").val());\r\n            });\r\n\r\n         $(\"#od_sphere,#os_sphere\").blur(function(){\r\n                formatQuarters($(this));\r\n                if($(\"#os_sphere\").val()==\"\")\r\n                    $(\"#os_sphere\").val($(\"#od_sphere\").val());\r\n            });\r\n\r\n        $(\"#od_cylinder,#os_cylinder\").blur(function(){\r\n                var obj = $(this);\r\n                formatQuarters(obj);\r\n                if(parseFloat(obj.val()) > 0)\r\n                   obj.val(\"-\" + obj.val()); //always negative\r\n                if($(\"#os_cylinder\").val()==\"\")\r\n                    $(\"#os_cylinder\").val($(\"#od_cylinder\").val());\r\n            });\r\n\r\n            $(\"#od_add\").blur(function(){\r\n                if($(\"#os_add\").val()==\"\")\r\n                    $(\"#os_add\").val($(\"#od_add\").val());\r\n            });\r\n        });\r\n\r\n        function applyUIStyle()\r\n        {\r\n            $(\"#od_sphere,#os_sphere,#od_cylinder,#os_cylinder,#od_axis,#os_axis\").parent().tooltip();\r\n        }\r\n\r\n        function isNumber(n) {\r\n          return !isNaN(parseFloat(n)) && isFinite(n);\r\n        }\r\n\r\n        function formatDegrees(obj)\r\n        {\r\n            var orig_val = obj.val();\r\n            if(!isNumber(orig_val))\r\n            {\r\n                obj.parent().removeClass(\"value_adjusted\").attr(\"title\",\"\");\r\n                return;\r\n            }\r\n\r\n            var calc_val = Math.abs(Math.floor(orig_val));\r\n\r\n            if( parseFloat(calc_val) == 180)\r\n            {\r\n                calc_val = 0;\r\n            }\r\n\r\n            calc_val = paddy(calc_val, 3, '0');\r\n\r\n            obj.val(calc_val);\r\n            markAdjusted(obj, orig_val, calc_val);\r\n        }\r\n\r\n        function formatQuarters(obj)\r\n        {\r\n            var orig_val= obj.val();\r\n            if(!isNumber(orig_val))\r\n            {\r\n                obj.parent().removeClass(\"value_adjusted\").attr(\"title\",\"\");\r\n                return;\r\n            }\r\n            var cal_val;\r\n            var val_floor = Math.floor(orig_val);\r\n            var val_abs =  Math.abs(orig_val);\r\n            var val_dec = val_abs - val_floor;\r\n            val_dec = Math.round(val_dec*100)/100;\r\n            var val_mod =  (val_abs-val_floor)%0.25;\r\n            val_mod = Math.round(val_mod*100)/100;\r\n            var val_diff = 0.25-val_mod;\r\n            val_diff = Math.round(val_diff*100)/100;\r\n\r\n            if(val_mod >= 0.125) /* 0.25 / 2 = 0.125 */\r\n            {\r\n                if(orig_val>=0)\r\n                    cal_val = parseFloat(orig_val) + parseFloat(val_diff);\r\n                else\r\n                    cal_val = parseFloat(orig_val) - parseFloat(val_diff);\r\n            }\r\n            else\r\n            {\r\n                if(orig_val>=0)\r\n                    cal_val = parseFloat(orig_val) - parseFloat(val_mod);\r\n                else\r\n                    cal_val = parseFloat(orig_val) + parseFloat(val_mod);\r\n            }\r\n\r\n            cal_val = Math.round(cal_val*100)/100;\r\n            var dec = Math.abs(cal_val)- Math.abs(Math.floor(cal_val));\r\n\r\n            if(parseFloat(dec) == 0)\r\n                cal_val = cal_val + \".00\";\r\n            obj.val(cal_val).attr(\"ov\",orig_val);\r\n\r\n            markAdjusted(obj, orig_val, cal_val);\r\n        }\r\n\r\n        function markAdjusted(obj, orig_val, cal_val)\r\n        {\r\n            if(cal_val != orig_val)\r\n            {\r\n                obj.parent().addClass(\"value_adjusted\").attr(\"title\",\"Adjusted Value, Original: \" + orig_val);\r\n            }\r\n            else\r\n            {\r\n                if(obj.val() == obj.attr(\"ov\"))\r\n                    obj.parent().removeClass(\"value_adjusted\").attr(\"title\",\"\");\r\n            }\r\n        }\r\n\r\n        function validate()\r\n        {\r\n            var valid = true;\r\n            $(\".error :first-child\").each(function(){\r\n                $(this).unwrap();\r\n            });\r\n            if($(\"#type\").val() == \"\")\r\n            {\r\n                valid = false;\r\n                $(\"#type\").wrap(\"<div class=\\\"error\\\">Required Field</div>\");\r\n            }\r\n            var odshere_v = $(\"od_sphere\").val();\r\n\r\n\r\n            return valid;\r\n        }\r\nbody\r\n  include includes/menu\r\n  h1 Inventory Update\r\n  span.explations The inventory number will be automatically generated\r\n\r\n  div(class=\"centered\")\r\n      form#locations(method=\"post\",action='/inventory')\r\n        table(class=\"centered\")\r\n            tbody\r\n                tr(title=\"Inventory Number\")\r\n                    th SKU\r\n                    td\r\n                        input(id=\"sku\",type=\"text\", name=\"sku\", /*disabled=\"disabled\",*/ value=reserved_sku)\r\n                tr(title=\"Type\")\r\n                    th Type\r\n                    td\r\n                        select(id=\"type\",name=\"type\", tabindex=\"1\")\r\n                            option(value=\"\")\r\n                            option(value=\"S\") Single Vision\r\n                            option(value=\"B\", selected=true) Bifocal\r\n                tr(title=\"Gender\")\r\n                    th Gender\r\n                    td\r\n                        select(name=\"gender\",tabindex=\"2\")\r\n                            option(value=\"\")\r\n                            option(value=\"M\") Male\r\n                            option(value=\"M\") Female\r\n                            option(value=\"U\", selected=true) Unisex\r\n                tr(title=\"Size\")\r\n                    th Size\r\n                    td\r\n                         select(name=\"size\",tabindex=\"3\")\r\n                            option(value=\"\")\r\n                            option(value=\"C\") Child\r\n                            option(value=\"S\") Small\r\n                            option(value=\"M\", selected=true) Medium\r\n                            option(value=\"L\") Large\r\n                tr(title=\"Tint\")\r\n                    th Tint\r\n                    td\r\n                         select(name=\"tint\",tabindex=\"4\")\r\n                            option(value=\"\")\r\n                            option(value=\"N\", selected=true) No\r\n                            option(value=\"D\") Dark\r\n                            option(value=\"L\") Light\r\n                tr(title=\"Material\")\r\n                    th Material\r\n                    td\r\n                         select(name=\"material\",tabindex=\"5\")\r\n                            option(value=\"\")\r\n                            option(value=\"M\", selected=true) Metal\r\n                            option(value=\"P\") Plastic\r\n        hr\r\n        table(class=\"centered\")\r\n            tr\r\n                th\r\n                th OD / Right\r\n                th OS / Left\r\n            tr\r\n                th Sphere\r\n                td\r\n                    input#od_sphere(type=\"text\", name=\"od_sphere\", tabindex=\"6\")\r\n                    div(id=\"debug\")\r\n                td\r\n                    input#os_sphere(type=\"text\", name=\"os_sphere\", tabindex=\"10\")\r\n            tr\r\n                th Cylinder\r\n                td\r\n                    input#od_cylinder(type=\"text\", name=\"od_cylinder\", tabindex=\"7\")\r\n                td\r\n                    input#os_cylinder(type=\"text\", name=\"os_cylinder\",tabindex=\"11\")\r\n            tr\r\n                th Axis\r\n                td\r\n                    input#od_axis(type=\"text\", name=\"od_axis\", tabindex=\"8\")\r\n                td\r\n                    input#os_axis(type=\"text\", name=\"os_axis\", tabindex=\"12\")\r\n            tr\r\n                th Add\r\n                td\r\n                    input#od_add(type=\"text\", name=\"od_add\", tabindex=\"9\")\r\n                td\r\n                    input#os_add(type=\"text\", name=\"os_add\", tabindex=\"13\")\r\n\r\n        p.buttons\r\n            input(type=\"submit\", value=\"Save\", onclick=\"return validate()\", tabindex=\"14\")\r\n\r\n\r\n\r\n"]],"start1":0,"start2":0,"length1":0,"length2":8511}]],"length":8511}
